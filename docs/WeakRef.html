<!DOCTYPE html><html><head><meta charset="utf-8"><title>WeakRef JavaScript API</title><meta name="description" content="Interactive API reference for the JavaScript WeakRef Object. A WeakRef allows holding on to another object, while still allowing that object to be garbage collected if there are no other strong refere"><link rel="stylesheet" type="text/css" href="styles.css"><script type="text/javascript">var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23450559-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();</script></head><body><script>if (sessionStorage.collapsed === 'true') {
  document.body.classList.add('members-collapsed');
}
if (localStorage.theme) {
  document.body.parentElement.classList.add(localStorage.theme);
}</script><div class="topnav"><a href="/">JavaScripture</a><div class="bookmarks"><a class="bookmark contribute" href="https://github.com/nkronlage/JavaScripture">Contribute via GitHub</a> <a class="bookmark" href="/feedback">Feedback</a></div></div><div class="container"><nav class="leftnav"><div id="searchContainer"><input id="searchBox" type="text" placeholder="Search (Ctrl + S)" autocomplete="false"><div id="resultsBox" style="display:none;"></div></div><div id="apichooser"><a href="#" onclick="openApiChooser(); return false;"><div class="arrow"></div><span id="selectedsets"></span></a><div id="obscure"></div><div id="apisets"><ul></ul></div></div><div class="toc"><h2>WeakRef</h2><div class="navgroup"><div class="group"><a href="#Constructors">Constructors</a></div><div class="group collapsed"><a href="#InstanceMethods" onclick="expandoClicked(this.parentNode); return false;"><div class="arrow"></div>Instance Methods</a><div class="subgroup"><a href="#deref_">deref</a></div></div></div><h2>JavaScript API</h2><div id="related-apis" class="navgroup"></div><h2>All API</h2><div id="rootObjs" class="navgroup"><span class="empty">No API set selected.</span></div></div></nav><div class="content"><h1 class="declaration"><span class="object">WeakRef</span> <span class="type">: <a href="/Object">Object</a></span></h1><div class="metadata"><span>constructor</span></div><div class="objectdescription">A WeakRef allows holding on to another object, while still allowing that object to be garbage collected if there are no other strong references to it. Note, JavaScript makes no guarantees on if or when an object will be garbage collected. See also <a href="/FinalizationRegistry">FinalizationRegistry</a>.<div class="membermetadata"><span class="ecmascript2021">ECMAScript 2021</span> <a href="https://tc39.es/ecma262/#sec-weak-ref-objects" class="spec">Spec</a></div></div><div><a name="Constructors"></a><h2>Constructors</h2><div class="member"><div class="expand-members" title="Toggle showing all descriptions and examples"></div><a name="WeakRef"></a> <a name="new_WeakRef_Object"></a><div class="declaration">new <span class="membername primary">WeakRef</span>(<span class="membername">target</span>&nbsp;:&nbsp;<a class="membertype" href="/Object">Object</a>)&nbsp;:&nbsp;<a class="membertype" href="/WeakRef">WeakRef</a></div><div class="member-body"><p class="description">Creates a new WeakRef that tracks <code>target</code>.</p><div class="membermetadata"><a href="https://tc39.es/ecma262/#sec-weak-ref-target" class="spec">Spec</a></div></div></div></div><div><a name="InstanceMethods"></a><h2>Instance Methods</h2><div class="member"><div class="expand-members" title="Toggle showing all descriptions and examples"></div><a name="deref"></a> <a name="deref_"></a><div class="declaration"><span class="membername primary">deref</span>()&nbsp;:&nbsp;<a class="membertype" href="/Object">Object</a></div><div class="member-body"><p class="description">Returns the target of <code>this</code> if it has not been garbage collected yet, otherwise returns <code>undefined</code>. If <code>deref()</code> returns a valid object, that object will not be garbage collected until control returns to the event loop, such as when returning from a callback or <code>await</code>ing a <a href="/Promise">Promise</a>.</p><div class="example"><div class="codePanel"><h4>Example:</h4><textarea class="code" rows="12" cols="60" wrap="off">
const sleep = (ms) =&gt; new Promise(r =&gt; setTimeout(r, ms));

let foo = {};
const weakRef = new WeakRef(foo);
foo = undefined; // Clear strong reference

const startTime = Date.now();
console.log(&#39;Allocating a lot of objects to force garbage collection&#39;);
while (weakRef.deref()) {
  for (let i = 0; i &lt; 100; i++) {
    const x = new Array(100);
  }
  await sleep(10);
}
console.log(`foo was reclaimed after ${((Date.now() - startTime) / 1000).toFixed(1)}s`);
</textarea><a onclick='executeExample(this.parentNode.parentNode, "WeakRef.deref"); return false' href="#" class="run">Run</a></div><div class="resultsPanel"><h4>Results:</h4><div style="position: relative"><div class="errormessage" style="display: none"></div><pre class="results"> </pre></div></div></div><p></p><div class="membermetadata"><a href="https://tc39.es/ecma262/#sec-weak-ref.prototype.deref" class="spec">Spec</a></div></div></div></div><div class="bottomnav"><a href="/">home</a> <a href="/license">license</a> <a href="https://github.com/nkronlage/JavaScripture">contribute</a> <a href="/feedback">feedback</a> <a id="toggle-theme" href="#">toggle light/dark mode</a></div><div class="copyright">Copyright Â© JavaScripture Contributors</div></div></div></body><script src="javascripture.js"></script></html>